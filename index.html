<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plataforma de Ejercicios - Derecho para No Abogados</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.95;
        }

        .student-info {
            background: #f8f9fa;
            padding: 30px;
            border-bottom: 3px solid #e9ecef;
        }

        .student-info h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #495057;
            font-weight: 600;
            font-size: 1.1em;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .section {
            padding: 30px;
            border-bottom: 2px solid #e9ecef;
        }

        .section:last-child {
            border-bottom: none;
        }

        .section h2 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.8em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-description {
            color: #6c757d;
            margin-bottom: 25px;
            font-size: 1.1em;
            line-height: 1.6;
        }

        .exercise {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .exercise:hover {
            border-color: #3498db;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.1);
        }

        .exercise h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .exercise-number {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            margin-right: 10px;
            font-weight: bold;
        }

        .clause-box {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            font-style: italic;
            color: #495057;
            line-height: 1.6;
        }

        .clause-classification {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .clause-option {
            padding: 10px;
            text-align: center;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .clause-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .clause-option.valid {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .clause-option.warning {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }

        .clause-option.abusive {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .clause-option.selected {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        .options {
            margin-top: 15px;
        }

        .option {
            display: block;
            padding: 12px;
            margin-bottom: 10px;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .option:hover {
            background: #e3f2fd;
            border-color: #3498db;
            transform: translateX(5px);
        }

        .option input[type="radio"],
        .option input[type="checkbox"] {
            margin-right: 12px;
        }

        .option.correct {
            background: #d4edda;
            border-color: #28a745;
        }

        .option.incorrect {
            background: #f8d7da;
            border-color: #dc3545;
        }

        .matching-exercise {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .matching-column {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #dee2e6;
        }

        .matching-column h4 {
            color: #495057;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.2em;
        }

        .matching-item {
            padding: 10px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            border: 2px solid #dee2e6;
            cursor: move;
            transition: all 0.3s;
        }

        .matching-item:hover {
            background: #e3f2fd;
            border-color: #3498db;
            transform: scale(1.02);
        }

        .matching-item.dragging {
            opacity: 0.5;
        }

        .drop-zone {
            min-height: 50px;
            padding: 10px;
            border: 2px dashed #dee2e6;
            border-radius: 6px;
            margin-bottom: 10px;
            background: white;
            transition: all 0.3s;
        }

        .drop-zone.drag-over {
            background: #e3f2fd;
            border-color: #3498db;
        }

        .drop-zone.correct {
            background: #d4edda;
            border-color: #28a745;
        }

        .drop-zone.incorrect {
            background: #f8d7da;
            border-color: #dc3545;
        }

        .btn {
            display: inline-block;
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-check {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            margin-right: 10px;
        }

        .btn-reset {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        }

        .btn-whatsapp {
            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);
            display: block;
            margin: 30px auto;
            padding: 15px 50px;
            font-size: 1.3em;
        }

        .btn-whatsapp:before {
            content: "📱 ";
            font-size: 1.2em;
        }

        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 10px;
            display: none;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result.success {
            background: #d4edda;
            border: 2px solid #28a745;
            color: #155724;
        }

        .result.error {
            background: #f8d7da;
            border: 2px solid #dc3545;
            color: #721c24;
        }

        .result.warning {
            background: #fff3cd;
            border: 2px solid #ffc107;
            color: #856404;
        }

        .score-display {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            margin: 20px 0;
            display: none;
        }

        .score-display h3 {
            color: #2c3e50;
            font-size: 2em;
            margin-bottom: 15px;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            margin: 20px auto;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            }
            50% {
                box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            }
            100% {
                box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            }
        }

        .score-circle.excellent {
            color: #28a745;
            border: 5px solid #28a745;
        }

        .score-circle.good {
            color: #3498db;
            border: 5px solid #3498db;
        }

        .score-circle.regular {
            color: #ffc107;
            border: 5px solid #ffc107;
        }

        .score-circle.needs-improvement {
            color: #dc3545;
            border: 5px solid #dc3545;
        }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            background: #e3f2fd;
            border-left: 5px solid #3498db;
            border-radius: 5px;
        }

        .feedback h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .likert-scale {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .likert-option {
            text-align: center;
            cursor: pointer;
            padding: 10px;
            transition: all 0.3s;
        }

        .likert-option:hover {
            transform: scale(1.1);
        }

        .likert-option input[type="radio"] {
            display: none;
        }

        .likert-option label {
            display: block;
            padding: 10px 15px;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .likert-option input[type="radio"]:checked + label {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e9ecef;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            border-radius: 15px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .timer {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
            z-index: 1000;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            position: relative;
            background: white;
            margin: 50px auto;
            padding: 40px;
            width: 90%;
            max-width: 600px;
            border-radius: 20px;
            animation: slideDown 0.5s;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 30px;
            cursor: pointer;
            color: #999;
            transition: color 0.3s;
        }

        .close-modal:hover {
            color: #333;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .matching-exercise {
                grid-template-columns: 1fr;
            }
            
            .clause-classification {
                grid-template-columns: 1fr;
            }
            
            .timer {
                position: static;
                margin: 20px auto;
                text-align: center;
            }
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="timer" id="timer">
        <span id="timerDisplay">00:00</span>
    </div>

    <div class="container">
        <div class="header">
            <h1>📚 Derecho para No Abogados</h1>
            <p>Plataforma de Ejercicios y Evaluación</p>
            <p style="font-size: 0.9em; opacity: 0.9; margin-top: 10px;">13 ejercicios para evaluar tu aprendizaje</p>
            <p style="font-size: 0.85em; opacity: 0.8; margin-top: 5px;">✅ Compatible con todos los dispositivos móviles</p>
        </div>

        <div class="student-info">
            <h2>📝 Información del Alumno</h2>
            <div class="form-group">
                <label for="studentName">Nombre Completo:</label>
                <input type="text" id="studentName" placeholder="Ingresa tu nombre completo" required>
            </div>
            <div class="form-group">
                <label for="studentEmail">Correo Electrónico:</label>
                <input type="email" id="studentEmail" placeholder="tu.correo@ejemplo.com" required>
            </div>
        </div>

        <!-- SECCIÓN 1: FUNDAMENTOS DEL DERECHO -->
        <div class="section">
            <h2>📖 Sección 1: Fundamentos del Derecho</h2>
            <p class="section-description">
                Evalúa tu comprensión sobre los conceptos básicos del sistema jurídico mexicano y la jerarquía de leyes.
            </p>

            <div class="exercise">
                <h3><span class="exercise-number">1</span>¿Cuál es la función principal del derecho en la sociedad?</h3>
                <div class="options">
                    <label class="option">
                        <input type="radio" name="q1" value="a">
                        a) Castigar a los criminales únicamente
                    </label>
                    <label class="option">
                        <input type="radio" name="q1" value="b">
                        b) Regular la convivencia social y resolver conflictos pacíficamente
                    </label>
                    <label class="option">
                        <input type="radio" name="q1" value="c">
                        c) Beneficiar solo a los abogados y jueces
                    </label>
                    <label class="option">
                        <input type="radio" name="q1" value="d">
                        d) Complicar la vida de los ciudadanos
                    </label>
                </div>
                <div class="result" id="result1"></div>
            </div>

            <div class="exercise">
                <h3><span class="exercise-number">2</span>En la jerarquía de leyes mexicanas, ¿cuál es el orden correcto de mayor a menor jerarquía?</h3>
                <div class="options">
                    <label class="option">
                        <input type="radio" name="q2" value="a">
                        a) Reglamentos municipales → Leyes estatales → Constitución
                    </label>
                    <label class="option">
                        <input type="radio" name="q2" value="b">
                        b) Constitución → Tratados Internacionales → Leyes Federales → Leyes Estatales
                    </label>
                    <label class="option">
                        <input type="radio" name="q2" value="c">
                        c) Leyes Federales → Constitución → Reglamentos
                    </label>
                    <label class="option">
                        <input type="radio" name="q2" value="d">
                        d) Todas las leyes tienen la misma jerarquía
                    </label>
                </div>
                <div class="result" id="result2"></div>
            </div>

            <div class="exercise">
                <h3><span class="exercise-number">3</span>¿Cuáles de las siguientes situaciones NO requieren necesariamente un abogado? (Selecciona todas las correctas)</h3>
                <div class="options">
                    <label class="option">
                        <input type="checkbox" name="q3" value="a">
                        a) Presentar una queja en PROFECO
                    </label>
                    <label class="option">
                        <input type="checkbox" name="q3" value="b">
                        b) Enfrentar un proceso penal como acusado
                    </label>
                    <label class="option">
                        <input type="checkbox" name="q3" value="c">
                        c) Pagar una multa de tránsito simple
                    </label>
                    <label class="option">
                        <input type="checkbox" name="q3" value="d">
                        d) Comprar un inmueble
                    </label>
                    <label class="option">
                        <input type="checkbox" name="q3" value="e">
                        e) Reclamar una garantía directamente con el proveedor
                    </label>
                </div>
                <div class="result" id="result3"></div>
            </div>
        </div>

        <!-- NUEVA SECCIÓN: IDENTIFICACIÓN DE CLÁUSULAS -->
        <div class="section">
            <h2>⚖️ Sección 2: Identificación de Cláusulas Contractuales</h2>
            <p class="section-description">
                Una habilidad fundamental es poder identificar cláusulas problemáticas en contratos. Clasifica las siguientes cláusulas según sean: Válidas (Verde), Cuestionables (Amarillo) o Abusivas/Ilegales (Rojo).
            </p>

            <div class="exercise">
                <h3><span class="exercise-number">4</span>Contrato de Arrendamiento - Cláusula sobre Depósito</h3>
                <div class="clause-box">
                    "El arrendatario deberá entregar como depósito en garantía el equivalente a un mes de renta, mismo que será devuelto al término del contrato, previa revisión del estado del inmueble."
                </div>
                <div class="clause-classification">
                    <div class="clause-option valid" onclick="selectClause(this, 'q4', 'valid')">
                        ✓ Válida
                    </div>
                    <div class="clause-option warning" onclick="selectClause(this, 'q4', 'warning')">
                        ⚠ Cuestionable
                    </div>
                    <div class="clause-option abusive" onclick="selectClause(this, 'q4', 'abusive')">
                        ✗ Abusiva
                    </div>
                </div>
                <div class="result" id="result4"></div>
            </div>

            <div class="exercise">
                <h3><span class="exercise-number">5</span>Contrato de Arrendamiento - Cláusula sobre Renuncia de Derechos</h3>
                <div class="clause-box">
                    "El arrendatario renuncia expresamente a cualquier derecho de reclamación presente o futura contra el arrendador, sin importar la causa o naturaleza del reclamo."
                </div>
                <div class="clause-classification">
                    <div class="clause-option valid" onclick="selectClause(this, 'q5', 'valid')">
                        ✓ Válida
                    </div>
                    <div class="clause-option warning" onclick="selectClause(this, 'q5', 'warning')">
                        ⚠ Cuestionable
                    </div>
                    <div class="clause-option abusive" onclick="selectClause(this, 'q5', 'abusive')">
                        ✗ Abusiva
                    </div>
                </div>
                <div class="result" id="result5"></div>
            </div>

            <div class="exercise">
                <h3><span class="exercise-number">6</span>Contrato de Trabajo - Cláusula sobre Horario</h3>
                <div class="clause-box">
                    "El trabajador laborará de lunes a viernes de 9:00 a 18:00 horas con una hora para alimentos. Las horas extras serán pagadas conforme a la Ley Federal del Trabajo."
                </div>
                <div class="clause-classification">
                    <div class="clause-option valid" onclick="selectClause(this, 'q6', 'valid')">
                        ✓ Válida
                    </div>
                    <div class="clause-option warning" onclick="selectClause(this, 'q6', 'warning')">
                        ⚠ Cuestionable
                    </div>
                    <div class="clause-option abusive" onclick="selectClause(this, 'q6', 'abusive')">
                        ✗ Abusiva
                    </div>
                </div>
                <div class="result" id="result6"></div>
            </div>

            <div class="exercise">
                <h3><span class="exercise-number">7</span>Contrato de Compraventa - Cláusula sobre Garantía</h3>
                <div class="clause-box">
                    "El vendedor no otorga ningún tipo de garantía sobre el producto. El comprador acepta el bien en el estado en que se encuentra y renuncia a cualquier reclamación por vicios ocultos."
                </div>
                <div class="clause-classification">
                    <div class="clause-option valid" onclick="selectClause(this, 'q7', 'valid')">
                        ✓ Válida
                    </div>
                    <div class="clause-option warning" onclick="selectClause(this, 'q7', 'warning')">
                        ⚠ Cuestionable
                    </div>
                    <div class="clause-option abusive" onclick="selectClause(this, 'q7', 'abusive')">
                        ✗ Abusiva
                    </div>
                </div>
                <div class="result" id="result7"></div>
            </div>

            <div class="exercise">
                <h3><span class="exercise-number">8</span>Contrato de Préstamo - Cláusula sobre Intereses</h3>
                <div class="clause-box">
                    "En caso de mora, el deudor pagará un interés moratorio del 10% mensual sobre el saldo insoluto, capitalizable mensualmente."
                </div>
                <div class="clause-classification">
                    <div class="clause-option valid" onclick="selectClause(this, 'q8', 'valid')">
                        ✓ Válida
                    </div>
                    <div class="clause-option warning" onclick="selectClause(this, 'q8', 'warning')">
                        ⚠ Cuestionable
                    </div>
                    <div class="clause-option abusive" onclick="selectClause(this, 'q8', 'abusive')">
                        ✗ Abusiva
                    </div>
                </div>
                <div class="result" id="result8"></div>
            </div>

            <div class="exercise">
                <h3><span class="exercise-number">9</span>Contrato de Servicios - Cláusula sobre Cancelación</h3>
                <div class="clause-box">
                    "El cliente puede cancelar el servicio en cualquier momento con 30 días de anticipación. Si cancela antes del plazo mínimo de 6 meses, deberá pagar una penalización equivalente al 50% del valor restante del contrato."
                </div>
                <div class="clause-classification">
                    <div class="clause-option valid" onclick="selectClause(this, 'q9', 'valid')">
                        ✓ Válida
                    </div>
                    <div class="clause-option warning" onclick="selectClause(this, 'q9', 'warning')">
                        ⚠ Cuestionable
                    </div>
                    <div class="clause-option abusive" onclick="selectClause(this, 'q9', 'abusive')">
                        ✗ Abusiva
                    </div>
                </div>
                <div class="result" id="result9"></div>
            </div>
        </div>

        <!-- SECCIÓN 3: CONTRATOS Y DOCUMENTOS -->
        <div class="section">
            <h2>📄 Sección 3: Contratos y Documentos Legales</h2>
            <p class="section-description">
                Demuestra tu capacidad para identificar elementos esenciales en contratos y documentos legales.
            </p>

            <div class="exercise">
                <h3><span class="exercise-number">10</span>Relaciona cada parte del contrato con su descripción:</h3>
                <div class="matching-exercise">
                    <div class="matching-column">
                        <h4>Partes del Contrato</h4>
                        <div class="matching-item" draggable="true" data-answer="objeto">Objeto</div>
                        <div class="matching-item" draggable="true" data-answer="precio">Precio/Contraprestación</div>
                        <div class="matching-item" draggable="true" data-answer="plazo">Plazo</div>
                        <div class="matching-item" draggable="true" data-answer="incumplimiento">Cláusula de Incumplimiento</div>
                    </div>
                    <div class="matching-column">
                        <h4>Descripciones</h4>
                        <div class="drop-zone" data-correct="objeto">Define qué se está acordando exactamente</div>
                        <div class="drop-zone" data-correct="precio">Establece qué da cada parte a cambio</div>
                        <div class="drop-zone" data-correct="plazo">Determina cuánto dura el acuerdo</div>
                        <div class="drop-zone" data-correct="incumplimiento">Especifica qué pasa si alguien no cumple</div>
                    </div>
                </div>
                <div class="result" id="result10"></div>
            </div>
        </div>

        <!-- SECCIÓN 4: DERECHOS LABORALES -->
        <div class="section">
            <h2>💼 Sección 4: Derechos Laborales</h2>
            <p class="section-description">
                Evalúa tu conocimiento sobre derechos laborales básicos y cálculo de finiquitos.
            </p>

            <div class="exercise">
                <h3><span class="exercise-number">11</span>Caso Práctico: Juan trabajó 2 años con un salario de $8,000 mensuales y fue despedido sin causa justificada. ¿Cuál es el monto aproximado de su indemnización constitucional (3 meses de salario)?</h3>
                <div class="options">
                    <label class="option">
                        <input type="radio" name="q11" value="a">
                        a) $8,000
                    </label>
                    <label class="option">
                        <input type="radio" name="q11" value="b">
                        b) $16,000
                    </label>
                    <label class="option">
                        <input type="radio" name="q11" value="c">
                        c) $24,000
                    </label>
                    <label class="option">
                        <input type="radio" name="q11" value="d">
                        d) $32,000
                    </label>
                </div>
                <div class="result" id="result11"></div>
            </div>

            <div class="exercise">
                <h3><span class="exercise-number">12</span>¿Cuánto tiempo tiene un trabajador para demandar por despido injustificado?</h3>
                <div class="options">
                    <label class="option">
                        <input type="radio" name="q12" value="a">
                        a) 30 días
                    </label>
                    <label class="option">
                        <input type="radio" name="q12" value="b">
                        b) 6 meses
                    </label>
                    <label class="option">
                        <input type="radio" name="q12" value="c">
                        c) 1 año
                    </label>
                    <label class="option">
                        <input type="radio" name="q12" value="d">
                        d) 2 años
                    </label>
                </div>
                <div class="result" id="result12"></div>
            </div>
        </div>

        <!-- SECCIÓN 5: INSTITUCIONES DE APOYO -->
        <div class="section">
            <h2>🏛️ Sección 5: Instituciones de Apoyo al Ciudadano</h2>
            <p class="section-description">
                Identifica a qué institución acudir según el tipo de problema legal.
            </p>

            <div class="exercise">
                <h3><span class="exercise-number">13</span>Relaciona cada problema con la institución correspondiente:</h3>
                <div class="matching-exercise">
                    <div class="matching-column">
                        <h4>Problemas</h4>
                        <div class="matching-item" draggable="true" data-answer="profeco">Producto defectuoso sin garantía válida</div>
                        <div class="matching-item" draggable="true" data-answer="condusef">Cargo no reconocido en tarjeta de crédito</div>
                        <div class="matching-item" draggable="true" data-answer="mp">Víctima de robo</div>
                        <div class="matching-item" draggable="true" data-answer="conapred">Discriminación laboral por embarazo</div>
                    </div>
                    <div class="matching-column">
                        <h4>Instituciones</h4>
                        <div class="drop-zone" data-correct="profeco">PROFECO</div>
                        <div class="drop-zone" data-correct="condusef">CONDUSEF</div>
                        <div class="drop-zone" data-correct="mp">Ministerio Público</div>
                        <div class="drop-zone" data-correct="conapred">CONAPRED</div>
                    </div>
                </div>
                <div class="result" id="result13"></div>
            </div>
        </div>

        <!-- SECCIÓN 6: PREVENCIÓN DE FRAUDES -->
        <div class="section">
            <h2>🛡️ Sección 6: Prevención de Fraudes</h2>
            <p class="section-description">
                Demuestra tu capacidad para identificar señales de alerta en situaciones potencialmente fraudulentas.
            </p>

            <div class="exercise">
                <h3><span class="exercise-number">14</span>¿Cuáles son señales de alerta de un posible fraude? (Selecciona todas las correctas)</h3>
                <div class="options">
                    <label class="option">
                        <input type="checkbox" name="q14" value="a">
                        a) Te presionan para tomar una decisión inmediata
                    </label>
                    <label class="option">
                        <input type="checkbox" name="q14" value="b">
                        b) Piden todos los documentos por escrito
                    </label>
                    <label class="option">
                        <input type="checkbox" name="q14" value="c">
                        c) Prometen ganancias garantizadas sin riesgo
                    </label>
                    <label class="option">
                        <input type="checkbox" name="q14" value="d">
                        d) Tienen oficinas físicas verificables
                    </label>
                    <label class="option">
                        <input type="checkbox" name="q14" value="e">
                        e) Piden dinero por adelantado para "trámites"
                    </label>
                    <label class="option">
                        <input type="checkbox" name="q14" value="f">
                        f) Evitan darte recibos o contratos
                    </label>
                </div>
                <div class="result" id="result14"></div>
            </div>

            <div class="exercise">
                <h3><span class="exercise-number">15</span>Si recibes una llamada diciendo que secuestraron a un familiar, ¿cuál es la acción correcta?</h3>
                <div class="options">
                    <label class="option">
                        <input type="radio" name="q15" value="a">
                        a) Depositar inmediatamente el dinero que piden
                    </label>
                    <label class="option">
                        <input type="radio" name="q15" value="b">
                        b) Colgar y llamar directamente a tu familiar para verificar
                    </label>
                    <label class="option">
                        <input type="radio" name="q15" value="c">
                        c) Dar toda la información que soliciten
                    </label>
                    <label class="option">
                        <input type="radio" name="q15" value="d">
                        d) Negociar el monto del rescate
                    </label>
                </div>
                <div class="result" id="result15"></div>
            </div>
        </div>

        <!-- CALIFICACIÓN GENERAL -->
        <div class="score-display" id="scoreDisplay">
            <h3>Tu Calificación Final</h3>
            <div class="score-circle" id="scoreCircle">
                <span id="finalScore">0%</span>
            </div>
            <div class="feedback" id="scoreFeedback"></div>
        </div>

        <!-- AUTOEVALUACIÓN DEL ALUMNO -->
        <div class="section">
            <h2>🎯 Autoevaluación del Aprendizaje</h2>
            <p class="section-description">
                Reflexiona sobre tu aprendizaje y los conocimientos adquiridos en el curso.
            </p>

            <div class="form-group">
                <label>¿Qué tan preparado(a) te sientes ahora para identificar situaciones que requieren atención legal?</label>
                <div class="likert-scale">
                    <div class="likert-option">
                        <input type="radio" name="self1" value="1" id="self1-1">
                        <label for="self1-1">Nada<br>preparado</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="self1" value="2" id="self1-2">
                        <label for="self1-2">Poco<br>preparado</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="self1" value="3" id="self1-3">
                        <label for="self1-3">Moderadamente<br>preparado</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="self1" value="4" id="self1-4">
                        <label for="self1-4">Bien<br>preparado</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="self1" value="5" id="self1-5">
                        <label for="self1-5">Muy bien<br>preparado</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>¿Qué tan útil consideras que será este conocimiento en tu vida diaria?</label>
                <div class="likert-scale">
                    <div class="likert-option">
                        <input type="radio" name="self2" value="1" id="self2-1">
                        <label for="self2-1">Nada<br>útil</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="self2" value="2" id="self2-2">
                        <label for="self2-2">Poco<br>útil</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="self2" value="3" id="self2-3">
                        <label for="self2-3">Moderadamente<br>útil</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="self2" value="4" id="self2-4">
                        <label for="self2-4">Muy<br>útil</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="self2" value="5" id="self2-5">
                        <label for="self2-5">Extremadamente<br>útil</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>¿Cuál fue el tema más valioso que aprendiste?</label>
                <select id="mostValuable">
                    <option value="">Selecciona una opción...</option>
                    <option value="fundamentos">Fundamentos del Derecho y Sistema Jurídico</option>
                    <option value="contratos">Cómo leer y entender contratos</option>
                    <option value="clausulas">Identificación de cláusulas abusivas</option>
                    <option value="laborales">Derechos laborales y cálculo de finiquitos</option>
                    <option value="instituciones">Instituciones de apoyo al ciudadano</option>
                    <option value="fraudes">Prevención de fraudes y estafas</option>
                    <option value="documentos">Documentos legales esenciales</option>
                    <option value="cuando-abogado">Cuándo necesito un abogado</option>
                </select>
            </div>

            <div class="form-group">
                <label>¿Qué acción concreta tomarás después de este curso?</label>
                <textarea id="concreteAction" rows="3" placeholder="Ejemplo: Revisaré mi contrato de trabajo, haré mi testamento, organizaré mis documentos importantes..."></textarea>
            </div>

            <div class="form-group">
                <label>¿Sobre qué tema te gustaría profundizar más?</label>
                <textarea id="deepenTopic" rows="3" placeholder="Menciona los temas que requieres mayor información o práctica..."></textarea>
            </div>
        </div>

        <!-- EVALUACIÓN DEL CURSO Y DOCENTE -->
        <div class="section">
            <h2>📊 Evaluación del Curso y Docente</h2>
            <p class="section-description">
                Tu opinión es muy importante para mejorar futuras ediciones del curso.
            </p>

            <div class="form-group">
                <label>Calidad del contenido del curso:</label>
                <div class="likert-scale">
                    <div class="likert-option">
                        <input type="radio" name="course1" value="1" id="course1-1">
                        <label for="course1-1">Muy<br>deficiente</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="course1" value="2" id="course1-2">
                        <label for="course1-2">Deficiente</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="course1" value="3" id="course1-3">
                        <label for="course1-3">Regular</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="course1" value="4" id="course1-4">
                        <label for="course1-4">Bueno</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="course1" value="5" id="course1-5">
                        <label for="course1-5">Excelente</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Claridad en las explicaciones del Mtro. Jorge Israel Clemente:</label>
                <div class="likert-scale">
                    <div class="likert-option">
                        <input type="radio" name="teacher1" value="1" id="teacher1-1">
                        <label for="teacher1-1">Muy<br>confuso</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="teacher1" value="2" id="teacher1-2">
                        <label for="teacher1-2">Confuso</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="teacher1" value="3" id="teacher1-3">
                        <label for="teacher1-3">Regular</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="teacher1" value="4" id="teacher1-4">
                        <label for="teacher1-4">Claro</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="teacher1" value="5" id="teacher1-5">
                        <label for="teacher1-5">Muy<br>claro</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Dominio del tema por parte del docente:</label>
                <div class="likert-scale">
                    <div class="likert-option">
                        <input type="radio" name="teacher2" value="1" id="teacher2-1">
                        <label for="teacher2-1">Muy<br>deficiente</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="teacher2" value="2" id="teacher2-2">
                        <label for="teacher2-2">Deficiente</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="teacher2" value="3" id="teacher2-3">
                        <label for="teacher2-3">Regular</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="teacher2" value="4" id="teacher2-4">
                        <label for="teacher2-4">Bueno</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="teacher2" value="5" id="teacher2-5">
                        <label for="teacher2-5">Excelente</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Utilidad de los ejercicios y casos prácticos:</label>
                <div class="likert-scale">
                    <div class="likert-option">
                        <input type="radio" name="course2" value="1" id="course2-1">
                        <label for="course2-1">Nada<br>útiles</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="course2" value="2" id="course2-2">
                        <label for="course2-2">Poco<br>útiles</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="course2" value="3" id="course2-3">
                        <label for="course2-3">Regular</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="course2" value="4" id="course2-4">
                        <label for="course2-4">Útiles</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="course2" value="5" id="course2-5">
                        <label for="course2-5">Muy<br>útiles</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>¿Recomendarías este curso a otras personas?</label>
                <div class="likert-scale">
                    <div class="likert-option">
                        <input type="radio" name="recommend" value="1" id="recommend-1">
                        <label for="recommend-1">Definitivamente<br>no</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="recommend" value="2" id="recommend-2">
                        <label for="recommend-2">Probablemente<br>no</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="recommend" value="3" id="recommend-3">
                        <label for="recommend-3">Tal vez</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="recommend" value="4" id="recommend-4">
                        <label for="recommend-4">Probablemente<br>sí</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="recommend" value="5" id="recommend-5">
                        <label for="recommend-5">Definitivamente<br>sí</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>¿Qué mejorarías del curso?</label>
                <textarea id="improvements" rows="3" placeholder="Tus sugerencias son muy valiosas para mejorar..."></textarea>
            </div>

            <div class="form-group">
                <label>Comentarios adicionales para el Mtro. Jorge Israel Clemente:</label>
                <textarea id="additionalComments" rows="3" placeholder="Cualquier comentario adicional que quieras compartir..."></textarea>
            </div>
        </div>

        <button class="btn btn-whatsapp" onclick="submitForm()">
            ENVIAR RESULTADOS POR WHATSAPP
        </button>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Preparando resultados para WhatsApp...</p>
        </div>
    </div>

    <!-- Modal de confirmación -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h2>✅ Resultados Listos</h2>
            <p>Se abrirá WhatsApp con tus resultados listos para enviar al Mtro. Jorge Israel Clemente Marié.</p>
            <p>Solo debes presionar el botón de enviar en WhatsApp.</p>
            <button class="btn" onclick="closeModal()">Entendido</button>
        </div>
    </div>

    <script>
        // Variables globales
        let startTime = Date.now();
        let answers = {};
        let score = 0;
        let totalQuestions = 15;

        // Timer
        setInterval(() => {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            document.getElementById('timerDisplay').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }, 1000);

        // Respuestas correctas
        const correctAnswers = {
            q1: 'b',
            q2: 'b',
            q3: ['a', 'c', 'e'],
            q4: 'valid',     // Depósito de un mes es válido
            q5: 'abusive',   // Renuncia total de derechos es abusiva
            q6: 'valid',     // Horario normal con horas extras según ley es válido
            q7: 'abusive',   // No dar ninguna garantía en compraventa es abusivo
            q8: 'abusive',   // 10% mensual es usura
            q9: 'warning',   // Penalización del 50% es cuestionable
            q10: 'matching',
            q11: 'c',
            q12: 'c',
            q13: 'matching',
            q14: ['a', 'c', 'e', 'f'],
            q15: 'b'
        };

        // Función para seleccionar cláusulas
        function selectClause(element, questionId, classification) {
            // Limpiar selección anterior
            const parent = element.parentElement;
            parent.querySelectorAll('.clause-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Marcar como seleccionada
            element.classList.add('selected');
            
            // Verificar respuesta
            const resultDiv = element.closest('.exercise').querySelector('.result');
            const isCorrect = classification === correctAnswers[questionId];
            
            if (isCorrect) {
                resultDiv.className = 'result success';
                resultDiv.textContent = '✅ ¡Correcto! Has identificado correctamente esta cláusula.';
                answers[questionId] = { correct: true, value: classification };
            } else {
                resultDiv.className = 'result error';
                let explanation = '';
                switch(questionId) {
                    case 'q4':
                        explanation = 'Un depósito de un mes es legal y común en contratos de arrendamiento.';
                        break;
                    case 'q5':
                        explanation = 'Esta cláusula es abusiva porque nadie puede renunciar anticipadamente a todos sus derechos.';
                        break;
                    case 'q6':
                        explanation = 'Este horario respeta la jornada legal y menciona el pago de horas extras conforme a la ley.';
                        break;
                    case 'q7':
                        explanation = 'El vendedor no puede eximir completamente su responsabilidad por vicios ocultos en bienes de consumo.';
                        break;
                    case 'q8':
                        explanation = '10% mensual (120% anual) es considerado usura. El límite legal es mucho menor.';
                        break;
                    case 'q9':
                        explanation = 'Una penalización del 50% puede ser excesiva y cuestionable, aunque no necesariamente ilegal.';
                        break;
                }
                resultDiv.textContent = `❌ Incorrecto. ${explanation}`;
                answers[questionId] = { correct: false, value: classification };
            }
            resultDiv.style.display = 'block';
        }

        // Auto-calificación para preguntas de opción múltiple
        document.querySelectorAll('input[type="radio"]').forEach(input => {
            input.addEventListener('change', function() {
                const questionName = this.name;
                const exerciseDiv = this.closest('.exercise');
                const resultDiv = exerciseDiv.querySelector('.result');
                const options = exerciseDiv.querySelectorAll('.option');
                
                // Limpiar clases anteriores
                options.forEach(opt => {
                    opt.classList.remove('correct', 'incorrect');
                });

                if (this.value === correctAnswers[questionName]) {
                    this.parentElement.classList.add('correct');
                    resultDiv.className = 'result success';
                    resultDiv.textContent = '✅ ¡Correcto! Excelente respuesta.';
                    resultDiv.style.display = 'block';
                    answers[questionName] = { correct: true, value: this.value };
                } else {
                    this.parentElement.classList.add('incorrect');
                    resultDiv.className = 'result error';
                    resultDiv.textContent = '❌ Incorrecto. Revisa el material del curso sobre este tema.';
                    resultDiv.style.display = 'block';
                    answers[questionName] = { correct: false, value: this.value };
                }
            });
        });

        // Auto-calificación para checkboxes
        ['q3', 'q14'].forEach(questionName => {
            const checkboxes = document.querySelectorAll(`input[name="${questionName}"]`);
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    checkMultipleChoice(questionName);
                });
            });
        });

        function checkMultipleChoice(questionName) {
            const selected = [];
            const checkboxes = document.querySelectorAll(`input[name="${questionName}"]:checked`);
            const exerciseDiv = checkboxes[0]?.closest('.exercise');
            if (!exerciseDiv) return;
            
            const resultDiv = exerciseDiv.querySelector('.result');
            const options = exerciseDiv.querySelectorAll('.option');
            
            checkboxes.forEach(cb => selected.push(cb.value));
            
            // Limpiar clases anteriores
            options.forEach(opt => {
                opt.classList.remove('correct', 'incorrect');
            });

            const correct = correctAnswers[questionName];
            const isCorrect = correct.length === selected.length && 
                             correct.every(val => selected.includes(val));

            if (isCorrect) {
                checkboxes.forEach(cb => cb.parentElement.classList.add('correct'));
                resultDiv.className = 'result success';
                resultDiv.textContent = '✅ ¡Perfecto! Has seleccionado todas las opciones correctas.';
                answers[questionName] = { correct: true, value: selected };
            } else {
                resultDiv.className = 'result warning';
                resultDiv.textContent = `⚠️ Revisa tu respuesta. Debes seleccionar ${correct.length} opciones.`;
                answers[questionName] = { correct: false, value: selected };
            }
            resultDiv.style.display = 'block';
        }

        // Sistema de relacionar mejorado para móviles y desktop
        let selectedItem = null;
        let selectedItemOriginalParent = null;

        // Inicializar ejercicios de relacionar
        function initMatchingExercises() {
            // Para cada ejercicio de relacionar
            document.querySelectorAll('.matching-exercise').forEach(exercise => {
                const items = exercise.querySelectorAll('.matching-item');
                const dropZones = exercise.querySelectorAll('.drop-zone');
                
                // Configurar items para click/tap
                items.forEach(item => {
                    item.addEventListener('click', function(e) {
                        e.preventDefault();
                        handleItemSelection(this, exercise);
                    });
                    
                    item.addEventListener('touchend', function(e) {
                        e.preventDefault();
                        handleItemSelection(this, exercise);
                    });
                });
                
                // Configurar drop zones para click/tap
                dropZones.forEach(zone => {
                    zone.addEventListener('click', function(e) {
                        e.preventDefault();
                        handleZoneSelection(this, exercise);
                    });
                    
                    zone.addEventListener('touchend', function(e) {
                        e.preventDefault();
                        handleZoneSelection(this, exercise);
                    });
                });
            });
        }

        function handleItemSelection(item, exercise) {
            // Si ya hay un item seleccionado en este ejercicio, deseleccionarlo
            exercise.querySelectorAll('.matching-item.selected').forEach(el => {
                el.classList.remove('selected');
            });
            exercise.querySelectorAll('.drop-zone.waiting').forEach(el => {
                el.classList.remove('waiting');
            });
            
            // Seleccionar el nuevo item
            item.classList.add('selected');
            selectedItem = item;
            selectedItemOriginalParent = item.parentElement;
            
            // Marcar las zonas de drop como esperando
            exercise.querySelectorAll('.drop-zone').forEach(zone => {
                zone.classList.add('waiting');
            });
        }

        function handleZoneSelection(zone, exercise) {
            if (!selectedItem || !exercise.contains(selectedItem)) {
                return;
            }
            
            // Si la zona ya tiene un item, devolverlo a su lugar original
            const existingItem = zone.querySelector('.matching-item');
            if (existingItem && existingItem !== selectedItem) {
                const leftColumn = exercise.querySelector('.matching-column');
                leftColumn.appendChild(existingItem);
            }
            
            // Mover el item seleccionado a la zona
            zone.appendChild(selectedItem);
            
            // Limpiar selección y estados
            selectedItem.classList.remove('selected');
            exercise.querySelectorAll('.drop-zone.waiting').forEach(el => {
                el.classList.remove('waiting');
            });
            
            selectedItem = null;
            selectedItemOriginalParent = null;
            
            // Verificar si todas las respuestas están completas
            checkMatching(exercise);
        }

        // También mantener compatibilidad con drag and drop para desktop
        function initDragAndDrop() {
            if (!('ontouchstart' in window)) {
                // Solo inicializar drag and drop si no es un dispositivo táctil
                document.querySelectorAll('.matching-item').forEach(item => {
                    item.draggable = true;
                    
                    item.addEventListener('dragstart', function(e) {
                        e.dataTransfer.effectAllowed = 'move';
                        e.dataTransfer.setData('text/html', this.innerHTML);
                        selectedItem = this;
                        this.classList.add('dragging');
                    });

                    item.addEventListener('dragend', function(e) {
                        this.classList.remove('dragging');
                        selectedItem = null;
                    });
                });

                document.querySelectorAll('.drop-zone').forEach(zone => {
                    zone.addEventListener('dragover', function(e) {
                        if (e.preventDefault) {
                            e.preventDefault();
                        }
                        e.dataTransfer.dropEffect = 'move';
                        this.classList.add('drag-over');
                        return false;
                    });

                    zone.addEventListener('dragleave', function(e) {
                        this.classList.remove('drag-over');
                    });

                    zone.addEventListener('drop', function(e) {
                        if (e.stopPropagation) {
                            e.stopPropagation();
                        }
                        e.preventDefault();
                        this.classList.remove('drag-over');
                        
                        if (selectedItem) {
                            // Verificar si ya hay un elemento
                            const existingItem = this.querySelector('.matching-item');
                            if (existingItem && existingItem !== selectedItem) {
                                // Devolver el elemento existente a la columna original
                                const leftColumn = this.closest('.matching-exercise').querySelector('.matching-column');
                                leftColumn.appendChild(existingItem);
                            }
                            
                            this.appendChild(selectedItem);
                            checkMatching(this.closest('.matching-exercise'));
                        }
                        
                        return false;
                    });
                });
            }
        }

        function checkMatching(exerciseContainer) {
            const exercise = exerciseContainer.closest('.exercise');
            const dropZones = exercise.querySelectorAll('.drop-zone');
            const resultDiv = exercise.querySelector('.result');
            let allCorrect = true;
            let allFilled = true;

            dropZones.forEach(zone => {
                const item = zone.querySelector('.matching-item');
                zone.classList.remove('correct', 'incorrect');
                
                if (item) {
                    if (item.dataset.answer === zone.dataset.correct) {
                        zone.classList.add('correct');
                    } else {
                        zone.classList.add('incorrect');
                        allCorrect = false;
                    }
                } else {
                    allFilled = false;
                }
            });

            if (allFilled) {
                if (allCorrect) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = '✅ ¡Excelente! Todas las relaciones son correctas.';
                    const questionId = exercise.querySelector('h3').textContent.includes('10') ? 'q10' : 'q13';
                    answers[questionId] = { correct: true };
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = '❌ Algunas relaciones son incorrectas. Intenta de nuevo.';
                    const questionId = exercise.querySelector('h3').textContent.includes('10') ? 'q10' : 'q13';
                    answers[questionId] = { correct: false };
                }
                resultDiv.style.display = 'block';
            } else {
                resultDiv.style.display = 'none';
            }
        }

        // Inicializar cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', function() {
            initMatchingExercises();
            initDragAndDrop();
        });

        // Calcular puntaje final
        function calculateScore() {
            score = 0;
            for (let key in answers) {
                if (answers[key].correct) {
                    score++;
                }
            }
            return Math.round((score / totalQuestions) * 100);
        }

        // Mostrar calificación
        function displayScore() {
            const percentage = calculateScore();
            const scoreDisplay = document.getElementById('scoreDisplay');
            const scoreCircle = document.getElementById('scoreCircle');
            const finalScore = document.getElementById('finalScore');
            const feedback = document.getElementById('scoreFeedback');
            
            scoreDisplay.style.display = 'block';
            finalScore.textContent = percentage + '%';
            
            // Clasificar el resultado
            if (percentage >= 90) {
                scoreCircle.className = 'score-circle excellent';
                feedback.innerHTML = '<h4>¡Excelente trabajo!</h4><p>Dominas muy bien los conceptos del curso. Estás listo para aplicar estos conocimientos en tu vida diaria.</p>';
            } else if (percentage >= 75) {
                scoreCircle.className = 'score-circle good';
                feedback.innerHTML = '<h4>¡Muy bien!</h4><p>Tienes un buen dominio de los conceptos. Revisa los temas donde tuviste errores para reforzar tu aprendizaje.</p>';
            } else if (percentage >= 60) {
                scoreCircle.className = 'score-circle regular';
                feedback.innerHTML = '<h4>Buen esfuerzo</h4><p>Has comprendido varios conceptos importantes. Te recomiendo repasar el material del curso para fortalecer las áreas de oportunidad.</p>';
            } else {
                scoreCircle.className = 'score-circle needs-improvement';
                feedback.innerHTML = '<h4>Sigue practicando</h4><p>Te recomiendo revisar nuevamente el material del curso. No dudes en contactar al instructor si tienes dudas específicas.</p>';
            }
            
            // Scroll suave hacia la calificación
            scoreDisplay.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // Función para formatear texto para WhatsApp
        function formatForWhatsApp(data) {
            let message = `*🎓 RESULTADOS DEL CURSO: DERECHO PARA NO ABOGADOS*\n`;
            message += `*Mtro. Jorge Israel Clemente Marié*\n\n`;
            
            message += `*📝 INFORMACIÓN DEL ALUMNO*\n`;
            message += `▪️ Nombre: ${data.studentInfo.name}\n`;
            message += `▪️ Correo: ${data.studentInfo.email}\n`;
            message += `▪️ Fecha: ${data.studentInfo.date}\n`;
            message += `▪️ Tiempo en plataforma: ${data.studentInfo.timeSpent}\n\n`;
            
            message += `*📊 CALIFICACIÓN DE EJERCICIOS*\n`;
            message += `▪️ Puntaje: *${data.exerciseScore.percentage}%*\n`;
            message += `▪️ Correctas: ${data.exerciseScore.correct} de ${data.exerciseScore.total}\n\n`;
            
            message += `*🎯 AUTOEVALUACIÓN*\n`;
            message += `▪️ Preparación legal: ${getScaleText(data.selfAssessment.preparedness)}\n`;
            message += `▪️ Utilidad: ${getScaleText(data.selfAssessment.usefulness)}\n`;
            message += `▪️ Tema más valioso: ${data.selfAssessment.mostValuable || 'No especificado'}\n`;
            message += `▪️ Acción a tomar: ${data.selfAssessment.concreteAction || 'No especificado'}\n`;
            message += `▪️ Temas para profundizar: ${data.selfAssessment.deepenTopic || 'No especificado'}\n\n`;
            
            message += `*⭐ EVALUACIÓN DEL CURSO*\n`;
            message += `▪️ Contenido: ${getScaleText(data.courseEvaluation.contentQuality)}\n`;
            message += `▪️ Claridad docente: ${getScaleText(data.courseEvaluation.teacherClarity)}\n`;
            message += `▪️ Dominio del tema: ${getScaleText(data.courseEvaluation.teacherKnowledge)}\n`;
            message += `▪️ Ejercicios: ${getScaleText(data.courseEvaluation.exercisesUtility)}\n`;
            message += `▪️ Recomendaría: ${getScaleText(data.courseEvaluation.wouldRecommend)}\n\n`;
            
            if (data.courseEvaluation.improvements && data.courseEvaluation.improvements !== 'Sin comentarios') {
                message += `*💡 Sugerencias:*\n${data.courseEvaluation.improvements}\n\n`;
            }
            
            if (data.courseEvaluation.additionalComments && data.courseEvaluation.additionalComments !== 'Sin comentarios') {
                message += `*💬 Comentarios:*\n${data.courseEvaluation.additionalComments}\n\n`;
            }
            
            message += `_Enviado desde Plataforma Empírica Legal Lab_`;
            
            return message;
        }

        function getScaleText(value) {
            const scales = {
                '1': '1/5 - Muy bajo',
                '2': '2/5 - Bajo',
                '3': '3/5 - Medio',
                '4': '4/5 - Alto',
                '5': '5/5 - Muy alto'
            };
            return scales[value] || 'No respondido';
        }

        // Enviar formulario
        function submitForm() {
            // Validar información del estudiante
            const studentName = document.getElementById('studentName').value;
            const studentEmail = document.getElementById('studentEmail').value;
            
            if (!studentName || !studentEmail) {
                alert('Por favor completa tu nombre y correo electrónico antes de enviar.');
                return;
            }

            // Validar que se hayan respondido todas las preguntas
            if (Object.keys(answers).length < totalQuestions) {
                alert('Por favor responde todas las preguntas antes de enviar.');
                return;
            }

            // Calcular y mostrar puntaje
            displayScore();

            // Recopilar todas las respuestas de evaluación
            const evaluationData = {
                studentInfo: {
                    name: studentName,
                    email: studentEmail,
                    date: new Date().toLocaleString('es-MX'),
                    timeSpent: document.getElementById('timerDisplay').textContent
                },
                exerciseScore: {
                    percentage: calculateScore(),
                    correct: score,
                    total: totalQuestions,
                    details: answers
                },
                selfAssessment: {
                    preparedness: document.querySelector('input[name="self1"]:checked')?.value || 'No respondido',
                    usefulness: document.querySelector('input[name="self2"]:checked')?.value || 'No respondido',
                    mostValuable: document.getElementById('mostValuable').value || 'No especificado',
                    concreteAction: document.getElementById('concreteAction').value || 'No especificado',
                    deepenTopic: document.getElementById('deepenTopic').value || 'No especificado'
                },
                courseEvaluation: {
                    contentQuality: document.querySelector('input[name="course1"]:checked')?.value || 'No respondido',
                    teacherClarity: document.querySelector('input[name="teacher1"]:checked')?.value || 'No respondido',
                    teacherKnowledge: document.querySelector('input[name="teacher2"]:checked')?.value || 'No respondido',
                    exercisesUtility: document.querySelector('input[name="course2"]:checked')?.value || 'No respondido',
                    wouldRecommend: document.querySelector('input[name="recommend"]:checked')?.value || 'No respondido',
                    improvements: document.getElementById('improvements').value || 'Sin comentarios',
                    additionalComments: document.getElementById('additionalComments').value || 'Sin comentarios'
                }
            };

            // Mostrar loading
            document.getElementById('loading').classList.add('active');

            // Crear el mensaje para WhatsApp
            const whatsappMessage = formatForWhatsApp(evaluationData);

            // Guardar en localStorage como backup
            localStorage.setItem('courseResults_' + Date.now(), JSON.stringify(evaluationData));

            // Simular procesamiento
            setTimeout(() => {
                document.getElementById('loading').classList.remove('active');
                
                // Crear link de WhatsApp
                const phoneNumber = '529982570828'; // Número sin el +
                const encodedMessage = encodeURIComponent(whatsappMessage);
                const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;
                
                // Abrir WhatsApp
                window.open(whatsappUrl, '_blank');
                
                // Mostrar modal de confirmación
                document.getElementById('confirmModal').style.display = 'block';
            }, 2000);
        }

        function closeModal() {
            document.getElementById('confirmModal').style.display = 'none';
        }

        // Cerrar modal al hacer clic fuera
        window.onclick = function(event) {
            const modal = document.getElementById('confirmModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }

        // Prevenir envío accidental del formulario
        window.addEventListener('beforeunload', function (e) {
            if (Object.keys(answers).length > 0 && !document.getElementById('confirmModal').style.display) {
                e.preventDefault();
                e.returnValue = '¿Estás seguro de que quieres salir? Tus respuestas no guardadas se perderán.';
            }
        });
    </script>
</body>
</html>
